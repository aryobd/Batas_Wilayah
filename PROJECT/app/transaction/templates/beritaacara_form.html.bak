

<!-- Leaflet -->
    <link rel="stylesheet" href="static/leaflet/leaflet.css">
    <link rel="stylesheet" href="static/leaflet/plugin/leaflet-controllayerstree.css">
 <link rel="stylesheet" href="static/leaflet/plugin/leaflet-fullscreen.min.css">
<style>
    input.leaflet-control-layers-selector {
        opacity: 1 !important;
        position: static !important;
        left: 2px;
        margin-right: 4px;
    }
	
</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<div class="col-lg-12">

    <div class="card card-outline">
        <div class="card-header pb-0">
            <input type='button' id='btn' value='Print' onclick='printDiv();'>
        </div>
        <div class="card-body">
			
			
			<div class="card card-outline-info">
				 <div class="card-header">
					<h4 class="mb-0 text-white">BERITA ACARA</h4>
				 </div>
				 <div class="card-body" id='printarea'>
					<table class="table" style="width:100%;font-weight: bold;">
						{{HEADER}}
					</table>
					<hr />
					<table class="table"style="width:100% ; text-align: justify;  text-justify: inter-word;">
						<tr><td>{{TEXT1}}</td></tr>
					</table>
					<table class="table"style="width:100%; text-align: justify;  text-justify: inter-word;">
						{{TEXT2}}
						{{TEXT3}}
					
						<tr><td colspan=2>Daftar koordinat Titik Kartometrik (TK) adalah sebagai berikut:</td></tr>
					
					</table>
					<table class="table"style="width:100%;border-collapse: collapse; text-align: justify;  text-justify: inter-word;">
						<thead>
							<tr>
								<th  rowspan=2  style='text-align: center;border: 1px solid black;'>NO</th><th rowspan=2  style='text-align: center;border: 1px solid black;'>TITIK KARTOMETRIK</th><th colspan=2  style='text-align: center;border: 1px solid black;'>KOORDINAT GEOGRAFIS</th><th  colspan=2  style='text-align: center;border: 1px solid black;'>KOORDINAT UTM</th>
							</tr>
							<tr>
								<th style='text-align: center;border: 1px solid black;'>LINTANG</th><th style='text-align: center;border: 1px solid black;'>BUJUR</th><th style='text-align: center;border: 1px solid black;'>x(m)</th><th style='text-align: ;border: 1px solid black;'>y(m)</th>
							</tr>
						</thead>
						<tbody>
							{{TEXT4}}
						</tbody>
					</table>
					<table class="table"style="width:100%; text-align: justify;  text-justify: inter-word;">
						<tr><td colspan=2>Demikian Berita Acara ini dibuat untuk digunakan sebagaimana mestinya. </td></tr>
						<tr><td colspan=2 style='text-align: center'>Yang bersepakat,</td></tr>
						<tr>
							<td style='text-align: center'>Kepala Desa	<br />{{nama_desa1}}	<br /><br /><br /><br /><br /><br /><span style=" text-decoration: underline;">{{txtKades1}}</span></td>	
							<td style='text-align: center'>Kepala Desa	<br />{{nama_desa2}}	<br /><br /><br /><br /><br /><br /><span style=" text-decoration: underline;">{{txtKades2}}</span></td>
						</tr>
						<tr><td colspan=2 style='text-align: center'>Mengetahui,</td></tr>
						<tr>
							{% if nama_kecamatan1 == nama_kecamatan2 %}
							<td colspan=2 style='text-align: center'>Camat	<br />{{nama_kecamatan1}}	<br /><br /><br /><br /><br /><br /><span style=" text-decoration: underline;">{{txtCamat1}}</span></td>
							 {% else %}
							<td style='text-align: center'>Camat	<br />{{nama_kecamatan1}}	<br /><br /><br /><br /><br /><br /><span style=" text-decoration: underline;">{{txtCamat1}}</span></td>	
							<td style='text-align: center'>Camat	<br />{{nama_kecamatan2}}	<br /><br /><br /><br /><br /><br /><span style=" text-decoration: underline;">{{txtCamat2}}</span></td>
							{% endif %}
						</tr>
						<tr><td colspan=2 style='text-align: center'>Tim Penetapan dan Penegasan Batas Desa <br/>{{nama_kabupaten}}	<br /><br /><br /><br /><br /><br /><span style=" text-decoration: underline;">{{txtPbdes}}</span></td></tr>
					</table>
					<br />
					<br />
					
				  </div>
				  <table class="table"style="width:100%;height: 60vh;">
						<tr><td>
							<div id="mapGambarBatasDesa" style="width: 100%;height: 60vh;"></div>
						</td></tr>
					</table>
			</div>
			
            
        </div>
    </div>
    
    
	
	
	
	
</div>


	

    <script src="static/leaflet/leaflet-src.js"></script>
   
		
    <script src="static/leaflet/plugin/leaflet-controllayerstree.js"></script>
    <script src="static/leaflet/plugin/leaflet-fullscreen.min.js"></script>
   
   
<script src="static/leaflet/esri-leaflet.js"></script>

    
    <script src="static/leaflet/draw/src/Leaflet.draw.js"></script>
    <script src="static/leaflet/draw/src/Leaflet.Draw.Event.js"></script>
    <link rel="stylesheet" href="static/leaflet/draw/src/leaflet.draw.css"/>

    <script src="static/leaflet/draw/src/Toolbar.js"></script>
    <script src="static/leaflet/draw/src/Tooltip.js"></script>

    <script src="static/leaflet/draw/src/ext/GeometryUtil.js"></script>
    <script src="static/leaflet/draw/src/ext/LatLngUtil.js"></script>
    <script src="static/leaflet/draw/src/ext/LineUtil.Intersect.js"></script>
    <script src="static/leaflet/draw/src/ext/Polygon.Intersect.js"></script>
    <script src="static/leaflet/draw/src/ext/Polyline.Intersect.js"></script>
    <script src="static/leaflet/draw/src/ext/TouchEvents.js"></script>

    <script src="static/leaflet/draw/src/draw/DrawToolbar.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.Feature.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.SimpleShape.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.Polyline.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.Marker.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.Circle.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.CircleMarker.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.Polygon.js"></script>
    <script src="static/leaflet/draw/src/draw/handler/Draw.Rectangle.js"></script>


    <script src="static/leaflet/draw/src/edit/EditToolbar.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/EditToolbar.Edit.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/EditToolbar.Delete.js"></script>

    <script src="static/leaflet/draw/src/Control.Draw.js"></script>

    <script src="static/leaflet/draw/src/edit/handler/Edit.Poly.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/Edit.SimpleShape.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/Edit.Rectangle.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/Edit.Marker.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/Edit.CircleMarker.js"></script>
    <script src="static/leaflet/draw/src/edit/handler/Edit.Circle.js"></script>


<script>
var map

	var idDesa1 = "{{desa1}}";
	 
	 var idDesa2 = "{{desa2}}";
	 
	 
	 
		var editorDesaIdWilayah = "{{id_wilayah}}";

	
	 var klaimidDesa1 = "{{klaimidDesa1}}";
	 
	 var klaimidDesa2 = "{{klaimidDesa2}}";

    // feature leaflet dara data json
    var datageo

    var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, ' +
            'AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    });

    var Esri_DarkGreyCanvas = L.tileLayer(
        "http://{s}.sm.mapstack.stamen.com/" +
        "(toner-lite,$fff[difference],$fff[@23],$fff[hsl-saturation@20])/" +
        "{z}/{x}/{y}.png",
        {
            attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, ' +
                'NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community'
        }
    );

    var Apimaxbox = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
            'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox/light-v9',
        tileSize: 512,
        zoomOffset: -1
    });
   
   

var layer_rbiesri = L.esri.tiledMapLayer({
		//url: 'https://portal.ina-sdi.or.id/arcgis/rest/services/RBI/Basemap/MapServer',
		url: 'https://geoservices.big.go.id/rbi/rest/services/BASEMAP/Rupabumi_Indonesia/MapServer',
		
		opacity: 1
	})
	
	
	var layer_indikatif = L.esri.dynamicMapLayer({
        url: 'https://geoservices.big.go.id/rbi/rest/services/BATASWILAYAH/Administrasi_AR_KelDesa_10K/MapServer',
        opacity: 1
    })


	


    var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });

    var layersTree = [
        {
            label: 'Base Map',
            children: [

                { label: 'RBI BIG - Esri', layer: layer_rbiesri },
				{ label: 'Satellite ESRI', layer: Esri_WorldImagery },
				{ label: 'Grey Canvas ESRI', layer: Esri_DarkGreyCanvas },
				{ label: 'Mapbox', layer: Apimaxbox },
					{ label: 'OpenStreetMap_Mapnik', layer: OpenStreetMap_Mapnik },
            ]
        }]

    map = L.map('mapGambarBatasDesa', {
        layers: [layer_rbiesri],
        //pmIgnore: false,
       // maxZoom: 17,
       // fullscreenControl: true,
       // fullscreenControlOptions: {
      //      position: 'topleft'
      //  }
    }).setView([-6.491857302, 106.848663298], 15);
	
	
	/*
	
		var overlayMaps = {
			//"Indikatif": layer_indikatif
			label: 'Indikatif',
            children: [
                { label: 'Indikatif', layer: layer_indikatif },
               
            ]
		};
		
		
		
    var ctr = L.control.layers.tree(layersTree, overlayMaps, {
        //namedToggle: true,
        selectorBack: false,
        closedSymbol: '&#8862; &#x1f5c0;',
        openedSymbol: '&#8863; &#x1f5c1;',
        // collapseAll: 'Collapse all',
        // expandAll: 'Expand all',
        collapsed: true,
    }).addTo(map)

*/

// define custom marker
var MyCustomMarker = L.Icon.extend({
  options: {
    shadowUrl: null,
    iconAnchor: new L.Point(12, 12),
    iconSize: new L.Point(24, 24),
    iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/6/6b/Information_icon4_orange.svg'
  }
});



var geojsonPointCreated = {}
var layerCreated 
var arrayIddesatitikkartometri = []

var charGenerateNo = "" 




	var klaimidDesa1Nama = ""
	var klaimidDesa2Nama = ""
	var arrayLayerTitikKartometri = []
	
	loadGeojson2 = function(){
		 $.get("transaction/setsubsegmen/geojson1", function(data, status){
			bicycleRental = data.data
			center = data.center
			klaimidDesa2Nama =  data.nama
			var testststs = L.geoJSON(bicycleRental, {
				style: function (feature) {
					 return { color: 'black' }
					//return feature.properties && feature.properties.style;
				},
				pointToLayer: function (feature, latlng) {
					
				}
				,onEachFeature: function (feature, layer) {
										
					map.addLayer(layer);
					
				},
				
			})
			//editableLayers.addLayer(testststs);
			//map.addLayer(testststs);
			
		  });
		  
	}
	
	loadGeojson1 = function(){
		 $.get("transaction/settitikkartometri/geojson1?id1="+idDesa1+"&id2="+idDesa2, function(data, status){
			bicycleRental = data.data
			center = data.center
			klaimidDesa2Nama =  data.nama
			var testststs = L.geoJSON(bicycleRental, {

				style: function (feature) {
					//return feature.properties && feature.properties.style;
				},
			

				//onEachFeature: onEachFeature,
		
				pointToLayer: function (feature, latlng) {
					if (feature.properties && feature.properties.simpul == 2) {
						var marker = 
						 L.circleMarker(latlng, {					
							radius: 10,
							fillColor: "#ff7800",
							color: "#000",
							weight: 1,
							opacity: 1,
							fillOpacity: 0.8
							
						});
						
						return marker;
					} else {
						var marker = 
						 L.circleMarker(latlng, {					
							radius: 10,
							fillColor: "#32CD32",
							color: "#000",
							weight: 1,
							opacity: 1,
							fillOpacity: 0.8
							
						});
						
						return marker;
					}
					
				}
				,onEachFeature: function (feature, layer) {
					
					map.addLayer(layer);
					
				},
				
			})
			//editableLayers.addLayer(testststs);
			//map.addLayer(testststs);
			loadGeojson2()
		  });
		  
	}

	loadGeojson = function(){	
		$(".tp-enabled").tooltip('enable')
		setTimeout(function(){ map.invalidateSize()}, 400);
		$('#txtDesa').html('')
		
		$('#txtUrut').on('change',function(){
			var urut = $('#txtUrut').val()
			urut = ('0000'+urut)
			urut = urut.substr(urut.length - 3);
			console.log(urut);
			$('#txtNo').html(charGenerateNo+'-'+urut);
		})
	
	
	
		  $.get("transaction/settitikkartometri/geojson?id1="+klaimidDesa1+"&id2="+klaimidDesa2, function(data, status){
			bicycleRental = data.data
			center = data.center
			klaimidDesa1Nama =  data.nama
			var testststs = L.geoJson(bicycleRental, {

				style: function (feature) {
					//return feature.properties && feature.properties.style;
				},
			

				//onEachFeature: onEachFeature,
		
				pointToLayer: function (feature, latlng) {
					
					return L.circleMarker(latlng, {
						radius: 3,
						fillColor: "#ff7800",
						color: "#000",
						weight: 1,
						opacity: 1,
						fillOpacity: 0.8
					});
				}
				,onEachFeature: function(feature, layer) {
					
					
					if ($('#txtDesa').html() != "")
						$('#txtDesa').append("<br />"+feature.properties.nama)
					else 
						$('#txtDesa').append(feature.properties.nama)
						
				  }
				
			})//.addTo(map);
			map.addLayer(testststs);
			//console.log(testststs.getBounds())
			
			center = center.replace("POINT(","").replace(")","")
			splitcenter = center.split(" ")
			
			map.setView([splitcenter[1], splitcenter[0]], 15)
			loadGeojson1()
		  });
		
		
		 
			
		  
	}
	
	
	
	$(document).ready(function() {
		loadGeojson();
		
		
    });

	
	showTitikPopup = function(a){
		var index = $(a).attr('data-index')
		arrayLayerTitikKartometri[index].openPopup();
	}
	
	function printDiv() {
	
	
	
	var	style = ' body {  width: 250mm;  height: 100%;  margin: 0 auto;  padding: 0;  font-size: 12pt;  background: rgb(204,204,204); } * {  box-sizing: border-box;  -moz-box-sizing: border-box;} .main-page {  width: 230mm;  min-height: 297mm;  margin: 10mm auto;  background: white;  box-shadow: 0 0 0.5cm rgba(0,0,0,0.5);} .sub-page {  padding: 1cm; } @page {  size: A4;  margin: 0;} @media print {  html, body {    width: 230mm;    height: 297mm;          }  .main-page {    margin: 0;    border: initial;    border-radius: initial;    width: initial;    min-height: initial;    box-shadow: initial;    background: initial;    page-break-after: always;  }        } .table th, .table td {  padding: 0.75rem;   vertical-align: top;  border-top: 1px solid #f3f1f1; }'
	  var divToPrint=document.getElementById('printarea');

	  var newWin=window.open('','Print-Window');

	  newWin.document.open();

	  newWin.document.write('<html><head> <style>'+style+'</style></head><body onload="window.print()"><div class="main-page"><div class="sub-page">'+divToPrint.innerHTML+'</div>   </div></body></html>');

	  newWin.document.close();

	 // setTimeout(function(){newWin.close();},10);

	}
	
	
</script>